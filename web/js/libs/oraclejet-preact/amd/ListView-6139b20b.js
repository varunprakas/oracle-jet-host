function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}define(["exports","preact/jsx-runtime","preact/hooks",'module',"./utils/UNSAFE_classNames","./utils/UNSAFE_arrayUtils","./utils/UNSAFE_mergeProps","./utils/UNSAFE_keys","./UNSAFE_VirtualizedCollection","./UNSAFE_Selector","./hooks/UNSAFE_useId","./classNames-73af7744","./hooks/PRIVATE_useSelection","./hooks/PRIVATE_useCurrentKey","./hooks/PRIVATE_useCollectionFocusRing","./UNSAFE_Skeleton","./UNSAFE_Flex","./Flex-155c2aac","./Skeleton-4d48f234","./VirtualizedCollection-3528428a"],(function(e,t,r,n,i,s,o,l,a,c,u,d,y,f,g,m,p,b,h,v){"use strict";const j="oj-listview-item",x="bvntlxs",S="gktvhyj",A="s1xqyijx",k="s1664glh",_="s1g33zwe",C="sz4hzft",w="b1sxv8rj",E="c1w05clj",K="f2pds8n",T=(e,t)=>"none"!==e&&("multiple"===e||!t);function F({children:e,itemKey:n,itemIndex:i,currentKey:s,isFocusRingVisible:o,isGridlineVisible:a,suggestion:y,selectedKeys:f,selectionMode:g,onSelectionChange:m}){const p=r.useRef(null),b=s==n,h=l.containsKey(f,n),v=d.classNames([x,j,a&&S,T(g,h)&&!h&&A,h&&k,h&&"single"===g&&_,"end"===y&&!(h&&"single"===g)&&C]),F=d.classNames([w,"multiple"===g&&E,b&&o&&K]);return t.jsx("div",Object.assign({role:"presentation","aria-rowindex":i+1,"data-oj-key":n,"data-oj-suggestion":!!y,class:v,ref:p},"number"==typeof n&&{"data-oj-key-type":"number"},{children:t.jsxs("div",Object.assign({id:u.useId(),class:F,role:"option","aria-posinset":i+1,"aria-setsize":-1,"aria-colindex":1,"aria-selected":"none"!==g?h:void 0},{children:["multiple"===g&&t.jsx(c.Selector,{rowKey:n,selectedKeys:f,onChange:m}),e]}))}),n)}const N="b1e4zkxl";function I({children:e,minimumCount:n=3}){const[i,s]=r.useState(!1);r.useEffect((()=>{setTimeout((()=>{s(!0)}),50)}),[]);const o=d.classNames([N]);return i&&e?t.jsx("div",Object.assign({class:o,role:"presentation"},{children:_toConsumableArray(Array(n)).map(((t,r)=>e(r)))})):null}s.stringLiteralArray(["visible","hidden"]);const R="bry7agl",O="b1nulapo",L="c1vo4hpw",U=(e,t)=>null!=t?t:{scroller:()=>e.current},z={all:!1,keys:new Set},V=(e,t)=>{const r=t.data.map((e=>e.metadata.key)),n=r.indexOf(e.value.start),i=r.indexOf(e.value.end),s=Math.min(n,i),o=Math.max(n,i);return-1===s?{offset:0,count:t.offset+r.length}:r.slice(s,o+1)};function M({sparkleHeight:e}){if(e<=0)return null;const r=e+"px",n=d.classNames([O]),i=d.classNames([L]);return t.jsx("div",Object.assign({class:i},{children:t.jsx("div",{class:n,style:{height:r}})}),"sparkle")}const P=e=>{const t=null==e?void 0:e.data,r=H(t);if(0===r)return null;return t.slice(0,r).reduce(((e,t,n)=>{const i=t.metadata.key;return n===r-1?e.set(i,"end"):e.set(i,!0),e}),new Map)},H=e=>{if(!e)return 0;const t=e.findIndex((e=>!e.metadata.suggestion));return-1===t?0:t},q=e=>"number"===e.dataset.ojKeyType?Number(e.dataset.ojKey):e.dataset.ojKey,D=(e,t)=>{if(e){const r=e.querySelectorAll(".oj-listview-item");for(let e=0;e<r.length;e++){if(t==q(r[e]))return r[e]}}return null},B=e=>{if(e){const t=e.querySelector(".oj-listview-item");if(t){return q(t)}}return null},G=(e,t,r)=>()=>{if(l.isKeyDefined(t)&&e){const n=D(e,t);if(n){const e=r?n.previousElementSibling:n.nextElementSibling;if(e)return q(e)}return B(e)}return null},W=(e,t)=>{if(e&&t){const r=t.getBoundingClientRect(),n=e.getBoundingClientRect();n.bottom>r.bottom?t.scrollTop=t.scrollTop+(n.bottom-r.bottom):n.top<r.top&&(t.scrollTop=t.scrollTop-(r.top-n.top))}},Y=e=>{const t=e.target.closest(".oj-listview-item");if(t){const e=q(t);return void 0===e?null:e}return null};e.ListView=function({accessibleSummary:e,data:n,children:i,currentKey:s,gridlines:a="hidden",selectedKeys:c=z,selectionMode:u="none",onCurrentKeyChange:m,onLoadRange:p,onSelectionChange:j,viewportConfig:x}){const S=r.useRef(null),A=r.useRef(),k=r.useRef(),[_,C]=r.useState(0),w="none"===u?void 0:"multiple"===u,E=null===n?void 0:"exact"===n.sizePrecision?n.totalSize:-1,K=d.classNames([R]),{currentKeyProps:T}=f.useCurrentKey(Y,G(S.current,s,!0),G(S.current,s,!1),s,m),N=r.useCallback((()=>{if(S.current&&m){const e=B(S.current);l.isKeyDefined(e)&&m({value:e})}}),[s,m]),O=!l.isKeyDefined(s)&&m?{onFocus:N}:{},[L,H]=g.useCollectionFocusRing((e=>{var t;return!!(null===(t=S.current)||void 0===t?void 0:t.contains(e))}),["ArrowUp","ArrowDown"]);r.useEffect((()=>{if(null!=s&&S.current){const e=D(S.current,s);if(e){const t=null==x?void 0:x.scroller();W(e,null!=t?t:S.current);const r=e.querySelector("[role=option]");r&&S.current.setAttribute("aria-activedescendant",r.id)}}}),[s]);const q=r.useCallback((e=>{j&&(!1===e.value.all&&e.value.keys.size>0&&(A.current=Array.from(e.value.keys).pop()),j(e))}),[A,j]),$=r.useCallback((e=>{if(n&&j){const t=V(e,n);Array.isArray(t)?j({value:{all:!1,keys:new Set(t)}}):(k.current=e,p(t))}}),[n,j,k,p]),{selectionProps:J}=y.useSelection((e=>e.target===S.current?void 0===s?null:s:Y(e)),c,u,!1,"replace",q,A.current,s,((e,t)=>G(S.current,e,t)),(e=>{if(S.current){const t=D(S.current,e);if(t){const e=null==x?void 0:x.scroller();W(t,null!=e?e:S.current)}}}),$);if(n&&k.current&&j){const e=V(k.current,n);Array.isArray(e)&&(j({value:{all:!1,keys:new Set(e)}}),k.current=void 0)}const Q=t.jsx(I,Object.assign({minimumCount:3},{children:()=>t.jsx(b.Flex,Object.assign({height:"12x",align:"center"},{children:t.jsx(h.Skeleton,{height:"4x"})}))})),X=r.useMemo((()=>P(n)),[null==n?void 0:n.data]),Z=t.jsx(M,{sparkleHeight:_});return r.useEffect((()=>{var e,t;if(X){let r=(null===(e=S.current)||void 0===e?void 0:e.querySelector("."+v.PLACEHOLDER_STYLE_CLASS)).offsetHeight;const n=null===(t=S.current)||void 0===t?void 0:t.querySelectorAll("[data-oj-suggestion]");null==n||n.forEach((e=>r+=e.offsetHeight)),C(r)}}),[X]),t.jsx("div",Object.assign({},o.mergeProps(T,J,H,O),{role:"listbox","aria-rowcount":E,"aria-colcount":1,ref:S,class:K,tabIndex:0,"aria-label":e,"aria-multiselectable":w},{children:null==n?t.jsx(I,{children:()=>t.jsx(b.Flex,Object.assign({height:"12x",align:"center"},{children:t.jsx(h.Skeleton,{height:"4x"})}))}):t.jsx(v.VirtualizedCollection,Object.assign({data:n,onLoadRange:p,itemSelector:".oj-listview-item",viewportConfig:U(S,x),loadMoreIndicator:Q,suggestions:Z},{children:e=>{const r=null==X?void 0:X.get(e.metadata.key);return t.jsx(F,Object.assign({itemIndex:e.index,itemKey:e.metadata.key,currentKey:s,isFocusRingVisible:L,isGridlineVisible:(n=e.index,"visible"===a&&n>0),selectedKeys:c,selectionMode:u,onSelectionChange:q},r&&{suggestion:r},{children:i(e)}));var n}}))}))}}));
//# sourceMappingURL=ListView-6139b20b.js.map
