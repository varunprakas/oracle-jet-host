{"version":3,"file":"UNSAFE_Layer.js","sources":["../../src/UNSAFE_Layer/LayerContext.ts","../../src/UNSAFE_Layer/LayerHost.tsx","../../src/UNSAFE_Layer/Layer.tsx","../../src/UNSAFE_Layer/LayerManager.tsx"],"sourcesContent":["import { createContext } from \"preact\";\n\nexport type LayerContextProps = {\n  getHost? : () => Element;\n};\n\nexport const LayerContext = createContext<LayerContextProps>({});\n\n","/**\n * The LayerHost is a div which is created in place\n * where you want to \"house\" a portaled content\n */\nimport { forwardRef } from 'preact/compat';\n\ntype Props = {};\n\nconst LayerHost = forwardRef<HTMLDivElement, Props>((_props, ref) => {\n  return <div id=\"__oj_layerhost_container\" ref={ref} />;\n});\n\nLayerHost.displayName = 'Forwarded<LayerHost>';\n\nexport default LayerHost;\n","import { VNode } from \"preact\";\nimport { createPortal, useContext, useLayoutEffect, useMemo, useState } from \"preact/compat\";\nimport { LayerContext } from \"./LayerContext\";\n\ntype Props = {\n  children: VNode;\n};\n\nconst Layer = (props: Props) => {\n  const context = useContext(LayerContext);\n  const defaultHost = context.getHost?.();\n  const host = useMemo(() => defaultHost, [defaultHost]);\n  const [layerContainer, setLayerContainer] = useState<Element | null>(null);\n  \n  // Really need useLayoutEffect instead of useEffect here. Otherwise the re-parented\n  // content does not get re-rendered with valid ref's\n  useLayoutEffect(() => {\n    if (!host) return;\n    const doc = host.ownerDocument ?? document;\n    const layer = doc.createElement(\"div\");\n\n    host.appendChild(layer);\n    setLayerContainer(layer);\n\n    return () => {\n      if(host && layer && host.contains(layer)) {\n        host.removeChild(layer);\n      } \n      setLayerContainer(null);\n    };\n  }, [host]);\n\n  return layerContainer && createPortal(props.children, layerContainer);\n};\n\nexport default Layer;\n","/**\n * The LayerManager wraps your application and creates two adjacent divs for\n * rendering your application and housing Layers.\n */\nimport { ComponentChildren } from 'preact';\nimport { useCallback, useState } from 'preact/compat';\nimport { LayerContext, LayerContextProps } from './LayerContext';\nimport LayerHost from './LayerHost';\n\ntype LayerManagerProps = {\n  children?: ComponentChildren;\n};\n\nexport function LayerManager({ children }: LayerManagerProps) {\n  const [defaultHost, setDefaultHost] = useState<Element>();\n  //const context = useContext(LayerContext);\n  const defaultHostRef = useCallback((el: Element | null) => {\n    // ref callbacks fire after the component has been unnmounted so we do not\n    // want to set state in this use-case\n    if (el !== null) {\n      setDefaultHost(el);\n    }\n  }, []);\n\n  return (\n    <LayerContext.Consumer>\n      {(value: LayerContextProps) => {\n        const defaultHostContext = defaultHost ? { getHost: () => defaultHost } : {};\n        const layerContext = value.getHost ? value : defaultHostContext;\n        return (\n          <LayerContext.Provider value={layerContext}>\n            {children}\n            {!value.getHost && <LayerHost ref={defaultHostRef} />}\n          </LayerContext.Provider>\n        );\n      }}\n    </LayerContext.Consumer>\n  );\n}\n"],"names":["LayerContext","createContext","LayerHost","forwardRef","_props","ref","_jsx","id","displayName","props","context","useContext","defaultHost","_a","getHost","host","useMemo","layerContainer","setLayerContainer","useState","useLayoutEffect","layer","ownerDocument","document","createElement","appendChild","contains","removeChild","createPortal","children","setDefaultHost","defaultHostRef","useCallback","el","Consumer","value","defaultHostContext","layerContext","_jsxs","jsxs","Provider","Object","assign"],"mappings":"uGAMaA,EAAeC,EAAaA,cAAoB,ICEvDC,EAAYC,EAAUA,YAAwB,CAACC,EAAQC,IACpDC,EAAAA,IAAA,MAAA,CAAKC,GAAG,2BAA2BF,IAAKA,MAGjDH,EAAUM,YAAc,+BCJTC,UACb,MAAMC,EAAUC,aAAWX,GACrBY,UAAcC,EAAAH,EAAQI,sCACtBC,EAAOC,EAAAA,SAAQ,IAAMJ,GAAa,CAACA,KAClCK,EAAgBC,GAAqBC,EAAQA,SAAiB,MAoBrE,OAhBAC,EAAAA,iBAAgB,WACd,IAAKL,EAAM,OACX,MACMM,GADwB,QAAlBR,EAAAE,EAAKO,qBAAa,IAAAT,EAAAA,EAAIU,UAChBC,cAAc,OAKhC,OAHAT,EAAKU,YAAYJ,GACjBH,EAAkBG,GAEX,KACFN,GAAQM,GAASN,EAAKW,SAASL,IAChCN,EAAKY,YAAYN,GAEnBH,EAAkB,SAEnB,CAACH,IAEGE,GAAkBW,EAAYA,aAACnB,EAAMoB,SAAUZ,oCCnBxC,UAAaY,SAAEA,IAC7B,MAAOjB,EAAakB,GAAkBX,EAAQA,WAExCY,EAAiBC,eAAaC,IAGvB,OAAPA,GACFH,EAAeG,KAEhB,IAEH,OACE3B,EAAAA,IAACN,EAAakC,SACX,CAAAL,SAACM,IACA,MAAMC,EAAqBxB,EAAc,CAAEE,QAAS,IAAMF,GAAgB,GACpEyB,EAAeF,EAAMrB,QAAUqB,EAAQC,EAC7C,OACEE,EAACC,KAAAvC,EAAawC,SAASC,OAAAC,OAAA,CAAAP,MAAOE,GAC3B,CAAAR,SAAA,CAAAA,GACCM,EAAMrB,SAAWR,EAAAA,IAACJ,EAAS,CAACG,IAAK0B"}