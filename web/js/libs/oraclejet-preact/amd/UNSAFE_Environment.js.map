{"version":3,"file":"UNSAFE_Environment.js","sources":["../../src/UNSAFE_Environment/EnvironmentContext.tsx","../../src/UNSAFE_Environment/EnvironmentProvider.tsx"],"sourcesContent":["/**\n * @license\n * Copyright (c) %FIRST_YEAR% %CURRENT_YEAR%, Oracle and/or its affiliates.\n * Licensed under The Universal Permissive License (UPL), Version 1.0\n * as shown at https://oss.oracle.com/licenses/upl/\n * @ignore\n */\n\nimport { createContext } from 'preact';\n\n/**\n * Defines user specific environment\n */\nexport type User = {\n  locale: string;\n  direction: 'rtl' | 'ltr';\n  forcedColors: 'none' | 'active';\n};\n\n/**\n * Defines theme specific environment that can be overridden by descendant components\n */\ntype Theme = {\n  colorScheme: 'light' | 'dark';\n  scale: 'lg' | 'md' | 'sm';\n};\n\n/**\n * Defines theme environment on root element\n */\nexport type RootTheme = Theme & {\n  name: string;\n};\n\n/**\n * Defines translation bundle type.\n */\nexport type TranslationBundle = Record<string, (...args: any[]) => string>;\n\n/**\n * Defines a type for translation property which is an object where\n * - key - string - bundle id\n * - value - object - strings to functions of the type (options?: object)=>string\n *\n * Translation bundle example:\n * const bundle = {\n *  @oracle/oracle-preact-bundle: {\n *      welcome: () => 'bienvenido',\n *      success: () => 'Ã©xito'\n *  }\n * }\n */\ntype Translations = { [bundleId: string]: TranslationBundle };\n\n/**\n * Environment specified at the root level\n */\nexport type RootEnvironment = {\n  // supports user preferences\n  user?: Partial<User>;\n  // supports theme settings\n  theme?: Partial<RootTheme>;\n  // supports translation bundles\n  translations?: Translations;\n};\n\n/**\n * Environment specified at the component level\n */\nexport type Environment = {\n  theme?: Partial<Theme>;\n  translations?: Translations;\n};\n\n/**\n * Default environment created for the application\n */\nexport const DefaultEnvironment = {\n  user: {\n    locale: document.documentElement.getAttribute('lang') || 'en',\n    direction: document.documentElement.getAttribute('dir') === 'rtl' ? 'rtl' : 'ltr',\n    forcedColors: window.matchMedia?.('(forced-colors: active)')?.matches ? 'active' : 'none'\n  },\n  theme: {\n    name: 'redwood',\n    colorScheme: 'light',\n    scale: 'lg'\n  }\n};\n\nexport const EnvironmentContext = createContext<RootEnvironment>(\n  DefaultEnvironment as RootEnvironment\n);\n","/**\n * @license\n * Copyright (c) %FIRST_YEAR% %CURRENT_YEAR%, Oracle and/or its affiliates.\n * The Universal Permissive License (UPL), Version 1.0\n * as shown at https://oss.oracle.com/licenses/upl/\n * @ignore\n */\n\nimport { ComponentChildren } from 'preact';\nimport { useMemo } from 'preact/hooks';\nimport {\n  EnvironmentContext,\n  Environment,\n  RootEnvironment,\n  DefaultEnvironment\n} from './EnvironmentContext';\nimport { LayerManager } from '../UNSAFE_Layer';\n\n// EnvironmentProvider properties\nexport declare type ProviderProperties<Env extends RootEnvironment | Environment> = {\n  environment?: Env;\n  children?: ComponentChildren;\n};\n\n// Custom merge function\nfunction mergeEnvironment(env1: RootEnvironment, env2: Partial<RootEnvironment> | undefined) {\n  const userValue = Object.assign({}, env1.user, env2?.user);\n  const themeValue = Object.assign({}, env1.theme, env2?.theme);\n\n  // Merge translation values - one level merge\n  const targetTranslations = Object.assign({}, env1.translations);\n  const sourceTranslations = env2?.translations || {};\n  Object.keys(sourceTranslations).forEach((key) => {\n    let newVal = sourceTranslations[key];\n    if (targetTranslations[key]) {\n      // merge is needed\n      newVal = Object.assign({}, targetTranslations[key], newVal);\n    }\n    targetTranslations[key] = newVal;\n  });\n\n  return { user: userValue, theme: themeValue, translations: targetTranslations };\n}\n\n/**\n * The RootEnvironmentProvider is a component that allows an application to setup an environment in one place.\n * In order to use it RootEnvironmentProvider should be added as a root of your application.\n * The component receives the RootEnvironment object that will be merged with the default environment and\n * passed to its children.\n */\nexport function RootEnvironmentProvider({\n  children,\n  environment\n}: ProviderProperties<RootEnvironment>) {\n  const mergedEnvironment = useMemo(\n    () => mergeEnvironment(DefaultEnvironment as RootEnvironment, environment),\n    [environment]\n  );\n  return (\n    <EnvironmentContext.Provider value={mergedEnvironment}>\n      <LayerManager>{children}</LayerManager>\n    </EnvironmentContext.Provider>\n  );\n}\n\n/**\n * The EnvironmentProvider is a component that should be used by the application when there is a need to overwrite\n * environment values for a subtree.\n * The component receives an Environment object that will be merged into the values provided by the nearest ancestor Provider.\n * The new environment will be passed to the component's children.\n * Note that some environment values cannot be overwritten. See the description of the Environment type for the list of values\n * that can be replaced.\n */\nexport function EnvironmentProvider({ children, environment }: ProviderProperties<Environment>) {\n  return (\n    <EnvironmentContext.Consumer>\n      {(consumerEnv: RootEnvironment) => {\n        const mergedEnvironment = useMemo(\n          () => mergeEnvironment(consumerEnv, environment),\n          [consumerEnv, environment]\n        );\n        return (\n          <EnvironmentContext.Provider value={mergedEnvironment}>\n            {children}\n          </EnvironmentContext.Provider>\n        );\n      }}\n    </EnvironmentContext.Consumer>\n  );\n}\n"],"names":["DefaultEnvironment","user","locale","document","documentElement","getAttribute","direction","forcedColors","_b","window","matchMedia","_a","call","matches","theme","name","colorScheme","scale","EnvironmentContext","createContext","mergeEnvironment","env1","env2","userValue","Object","assign","themeValue","targetTranslations","translations","sourceTranslations","keys","forEach","key","newVal","children","environment","_jsx","Consumer","consumerEnv","mergedEnvironment","useMemo","jsx","Provider","value","LayerManager"],"mappings":"6IA6EO,MAAMA,EAAqB,CAChCC,KAAM,CACJC,OAAQC,SAASC,gBAAgBC,aAAa,SAAW,KACzDC,UAA4D,QAAjDH,SAASC,gBAAgBC,aAAa,OAAmB,MAAQ,MAC5EE,cAA8D,QAAhDC,EAAoB,UAApBC,OAAOC,kBAAa,IAAAC,OAAA,EAAAA,EAAAC,KAAAH,OAAA,kCAA4B,IAAAD,OAAA,EAAAA,EAAAK,SAAU,SAAW,QAErFC,MAAO,CACLC,KAAM,UACNC,YAAa,QACbC,MAAO,OAIEC,EAAqBC,EAAaA,cAC7CnB,GClEF,SAASoB,EAAiBC,EAAuBC,GAC/C,MAAMC,EAAYC,OAAOC,OAAO,GAAIJ,EAAKpB,KAAMqB,MAAAA,OAAI,EAAJA,EAAMrB,MAC/CyB,EAAaF,OAAOC,OAAO,GAAIJ,EAAKP,MAAOQ,MAAAA,OAAI,EAAJA,EAAMR,OAGjDa,EAAqBH,OAAOC,OAAO,GAAIJ,EAAKO,cAC5CC,GAAqBP,MAAAA,OAAA,EAAAA,EAAMM,eAAgB,GAUjD,OATAJ,OAAOM,KAAKD,GAAoBE,SAASC,IACvC,IAAIC,EAASJ,EAAmBG,GAC5BL,EAAmBK,KAErBC,EAAST,OAAOC,OAAO,GAAIE,EAAmBK,GAAMC,IAEtDN,EAAmBK,GAAOC,KAGrB,CAAEhC,KAAMsB,EAAWT,MAAOY,EAAYE,aAAcD,0DAgCzBO,SAAEA,EAAFC,YAAYA,IAC9C,OACEC,EAAAA,IAAClB,EAAmBmB,SACjB,CAAAH,SAACI,IACA,MAAMC,EAAoBC,WACxB,IAAMpB,EAAiBkB,EAAaH,IACpC,CAACG,EAAaH,IAEhB,OACEC,EAAAK,IAACvB,EAAmBwB,SAAQlB,OAAAC,OAAA,CAACkB,MAAOJ,GAAiB,CAAAL,SAClDA,6CAjC2BA,SACtCA,EADsCC,YAEtCA,IAEA,MAAMI,EAAoBC,EAAOA,SAC/B,IAAMpB,EAAiBpB,EAAuCmC,IAC9D,CAACA,IAEH,OACEC,EAAAA,IAAClB,EAAmBwB,wBAASC,MAAOJ,GAAiB,CAAAL,SACnDE,MAACQ,eAAY,CAAAV,SAAEA"}