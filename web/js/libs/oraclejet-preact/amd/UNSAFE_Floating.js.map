{"version":3,"file":"UNSAFE_Floating.js","sources":["../../src/UNSAFE_Floating/Floating.tsx"],"sourcesContent":["import { JSX, RefObject, Ref } from 'preact';\nimport { useLayoutEffect, MutableRef, useMemo } from 'preact/hooks';\nimport { forwardRef } from 'preact/compat';\nimport { useFloating, shift, flip, offset } from '../hooks/UNSAFE_useFloating';\nimport { autoUpdate } from '@floating-ui/dom';\nimport { Offset, Placement, Coords, VirtualElement, Rect } from '../hooks/UNSAFE_useFloating';\nimport useOutsideClick from '../hooks/UNSAFE_useOutsideClick';\n\ntype IntrinsicProps = Pick<JSX.HTMLAttributes<HTMLDivElement>, 'children' | 'class'>;\n\ntype Props = IntrinsicProps & {\n  /**\n   * Placement of the popup element relative to the trigger.\n   */\n  placement?: Placement;\n\n  /**\n   * Trigger element reference.\n   */\n  anchorRef: RefObject<HTMLElement | Coords>;\n\n  /**\n   * Placement offset.\n   */\n  offsetValue?: Offset;\n\n  /**\n   * Click outside callback.\n   */\n  onClickOutside?: (event: MouseEvent) => void;\n};\n\nfunction assignRef<T>(ref: Ref<T> | undefined, value: T | null) {\n  if (ref == null) return;\n\n  if (typeof ref === 'function') {\n    ref(value);\n    return;\n  }\n\n  try {\n    // @ts-ignore\n    ref.current = value;\n  } catch (error) {\n    throw new Error(`Cannot assign value '${value}' to ref '${ref}'`);\n  }\n}\n\nfunction mergeRefs<T>(...refs: (Ref<T> | undefined)[]) {\n  return (node: T | null) => {\n    refs.forEach((ref) => assignRef(ref, node));\n  };\n}\n\nexport const Floating = forwardRef(\n  (\n    {\n      children,\n      onClickOutside,\n      placement = 'bottom',\n      anchorRef,\n      offsetValue,\n      class: className\n    }: Props,\n    ref: MutableRef<HTMLElement | null>\n  ) => {\n    const { x, y, reference, floating, refs } = useFloating({\n      placement: placement,\n      middleware: [offset(offsetValue), flip({ mainAxis: true, crossAxis: true }), shift()],\n      whileElementsMounted: autoUpdate\n    });\n\n    if (onClickOutside) {\n      useOutsideClick({ isDisabled: false, ref: refs.floating, handler: onClickOutside });\n    }\n\n    useLayoutEffect(() => {\n      const coords = anchorRef as RefObject<Coords>;\n      const element = anchorRef as RefObject<HTMLElement>;\n      const virtualEl: VirtualElement = {\n        getBoundingClientRect() {\n          return {\n            width: 0,\n            height: 0,\n            x: coords.current!.x,\n            y: coords.current!.y,\n            top: coords.current!.y,\n            left: coords.current!.x,\n            right: coords.current!.x,\n            bottom: coords.current!.y\n          };\n        }\n      };\n      const result = coords.current && coords.current.x ? virtualEl : element.current;\n      reference(result);\n    }, [anchorRef.current]);\n\n    const stableRef = useMemo(() => mergeRefs(ref, floating), [ref, floating]);\n\n    const content = (\n      <div\n        class={className}\n        ref={stableRef}\n        style={{\n          display: 'block',\n          position: 'absolute',\n          top: y ?? '',\n          left: x ?? ''\n        }}>\n        {children}\n      </div>\n    );\n    return content;\n  }\n);\n\nexport { Offset, Placement, Coords, Rect };\n"],"names":["mergeRefs","refs","node","forEach","ref","value","current","error","Error","assignRef","Floating","forwardRef","children","onClickOutside","placement","anchorRef","offsetValue","class","className","x","y","reference","floating","useFloating","middleware","offset","flip","mainAxis","crossAxis","shift","D","whileElementsMounted","autoUpdate","N","useOutsideClick","isDisabled","handler","useLayoutEffect","coords","element","virtualEl","getBoundingClientRect","width","height","top","left","right","bottom","result","stableRef","useMemo","_jsx","Object","assign","style","display","position"],"mappings":"6LAgDA,SAASA,KAAgBC,GACvB,OAAQC,IACND,EAAKE,SAASC,GAlBlB,SAAsBA,EAAyBC,GAC7C,GAAW,MAAPD,EAEJ,GAAmB,mBAARA,EAKX,IAEEA,EAAIE,QAAUD,EACd,MAAOE,GACP,MAAM,IAAIC,MAAM,wBAAwBH,cAAkBD,WAR1DA,EAAIC,GAckBI,CAAUL,EAAKF,MAI5B,MAAAQ,EAAWC,EAAAA,YACtB,EAEIC,SAAAA,EACAC,eAAAA,EACAC,UAAAA,EAAY,SACZC,UAAAA,EACAC,YAAAA,EACAC,MAAOC,GAETd,KAEA,MAAMe,EAAEA,EAAFC,EAAKA,EAALC,UAAQA,EAARC,SAAmBA,EAAnBrB,KAA6BA,GAASsB,cAAY,CACtDT,UAAWA,EACXU,WAAY,CAACC,EAAAA,OAAOT,GAAcU,EAAAA,EAAK,CAAEC,UAAU,EAAMC,WAAW,IAASC,EAAKC,KAClFC,qBAAsBC,EAAUC,IAG9BpB,GACFqB,UAAgB,CAAEC,YAAY,EAAO/B,IAAKH,EAAKqB,SAAUc,QAASvB,IAGpEwB,EAAAA,iBAAgB,KACd,MAAMC,EAASvB,EACTwB,EAAUxB,EACVyB,EAA4B,CAChCC,sBAAqB,KACZ,CACLC,MAAO,EACPC,OAAQ,EACRxB,EAAGmB,EAAOhC,QAASa,EACnBC,EAAGkB,EAAOhC,QAASc,EACnBwB,IAAKN,EAAOhC,QAASc,EACrByB,KAAMP,EAAOhC,QAASa,EACtB2B,MAAOR,EAAOhC,QAASa,EACvB4B,OAAQT,EAAOhC,QAASc,KAIxB4B,EAASV,EAAOhC,SAAWgC,EAAOhC,QAAQa,EAAIqB,EAAYD,EAAQjC,QACxEe,EAAU2B,KACT,CAACjC,EAAUT,UAEd,MAAM2C,EAAYC,WAAQ,IAAMlD,EAAUI,EAAKkB,IAAW,CAAClB,EAAKkB,IAehE,OAZE6B,EAAAA,IAAA,MAAAC,OAAAC,OAAA,CACEpC,MAAOC,EACPd,IAAK6C,EACLK,MAAO,CACLC,QAAS,QACTC,SAAU,WACVZ,IAAKxB,MAAAA,EAAAA,EAAK,GACVyB,KAAM1B,MAAAA,EAAAA,EAAK,KAEZ,CAAAP,SAAAA"}